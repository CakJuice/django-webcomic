{% extends 'layouts/main_layout.html' %}
{% load static %}

{% block meta_description %}{{ comic.description }}{% endblock %}
{% block meta_keywords %}Read, Comic, Free, {{ comic.genre.name }}{% endblock %}
{% block title %}{{ comic.title }}{% endblock %}

{% block content %}
  <div id="main-content" class="container my-3">
    {% if messages %}
      {% include 'includes/alert_message.html' %}
    {% endif %}

    <h3>{{ comic.title }}</h3>
    <p>
      Genre: <a href="{% url 'genre_detail' slug=comic.genre.slug %}">{{ comic.genre.name }}</a>
      - {{ comic.get_state_display }}
    </p>

    <p>{{ comic.description }}</p>

    {% if user.is_authenticated and user == comic.author %}
      <a role="button" href="{% url 'comic_update' slug=comic.slug %}" class="btn btn-primary">Edit</a>
      {% if comic.state == 0 %}
        <a role="button" href="{% url 'comic_state' slug=comic.slug state=1 %}" class="btn btn-success">Publish</a>
      {% elif comic.state == 1 %}
        <a role="button" href="{% url 'comic_state' slug=comic.slug state=9 %}" class="btn btn-secondary">Archive</a>
      {% else %}
        <a role="button" href="{% url 'comic_state' slug=comic.slug state=0 %}" class="btn btn-secondary">Set to Draft</a>
      {% endif %}
    {% endif %}
  </div>
{% endblock %}

{% block extra_script %}
<script type="text/babel" src="{% static 'js/react-pagination.js' %}"></script>
<script type="text/babel">
  const mainContent = document.getElementById('main-content');
  const url = "{% url 'comic_chapter_ajax' comic_slug=comic.slug %}?page=" + {{ request.GET.page }};

  axios.get(url).then((response) => {
    const data = response.data;
    if (data.success) {
      if (data.pagination.has_prev || data.pagination.has_next) {
        mainContent.innerHTML += '<div id="pagination-container"></div>';
        const paginationContainer = document.getElementById('pagination-container');
        ReactDOM.render(<Pagination pagination={data.pagination}/>, paginationContainer);
      }
    }
  });

</script>
{% endblock %}